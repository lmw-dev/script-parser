## AI 指令包 (AI Instruction Package) - TOM-439

### 🎯 目标定义 (Objective)
* **Linear Issue**: TOM-439 - Web: 实现"请我喝杯咖啡"打赏功能
* **核心指令**: 在“脚本快拆”Web 应用 (`apps/web`) 中集成一个基于**微信支付**和**支付宝收款二维码**的自愿打赏功能。在指定位置（如页脚、结果页）添加展示二维码的 UI 组件，并包含清晰的说明文字。确保 UI 风格与现有 shadcn/ui 保持一致，并预留点击/查看事件的追踪点。

### 📋 上下文引用 (Context References)
* **主要操作文件**:
    * `@components/layout/Footer.tsx` 
    * `@app/result/page.tsx` 
    * (可能需要创建新的组件, e.g., `@components/feature/DonationSection.tsx`) 
    * `.env.development` / `.env.production` (位于 `src` 目录下) 
* **设计/规范**:
    * `Linear Issue TOM-439 (作为 PRD)` 
    * `@rules/001-gen-constitution-principles.mdc` 
    * `@rules/010-gen-coding-standards.mdc` 
    * `@rules/040-spec-visual-design-principles.mdc` 
* **资源**:
    * 微信收款二维码图片路径: `/wechat_donate_qr.png` (位于 `apps/web/public/`)
    * 支付宝收款二维码图片路径: `/alipay_donate_qr.png` (位于 `apps/web/public/`)

### 🔧 实现要求/约束 (Requirements & Constraints)
* **技术栈**: Next.js (App Router), React, TypeScript, Tailwind CSS, shadcn/ui。
功能要求:

1. 引入环境变量: 在 .env 文件 (及相应的 .env.example 或类型定义) 中添加一个名为 NEXT_PUBLIC_ENABLE_DONATION 的环境变量。该变量用于控制打赏功能的全局开关 (true 表示启用, false 表示禁用)。

2. 创建一个可复用的 React 组件 (DonationSection?) 用于展示打赏信息。

3. 该组件应能接收二维码图片路径作为 props。

4. 组件需包含标题文字、说明文字以及二维码图片。

5. 条件渲染: 在页脚 (Footer.tsx) 和结果页 (result/page.tsx) 中，仅当 NEXT_PUBLIC_ENABLE_DONATION 环境变量的值为 true 时，才实例化并展示 DonationSection 组件。 

6. UI 元素需符合项目风格。

7. 预留追踪点: 为二维码图片或容器添加 data-testid 或 id，并绑定事件处理器（初始可为空），以便后续追踪。

* **约束**:
    * **禁止**引入新的外部 UI 库。
    * **禁止**实现任何与后端 API 的交互。这是一个纯前端 UI 任务。
    * **禁止**在二维码旁边显示任何具体的金额建议。

### 🧪 测试策略 (Test-First)
* **本任务主要测试类型**: **组件测试 (Component Test)**。
* **测试策略**:
    * **创建测试文件**: 为 `DonationSection` 组件创建 `@apps/web/src/components/feature/DonationSection.test.tsx`。
    * **编写失败的测试**:

测试 1: 验证组件在接收到正确的图片路径 props 时，能够成功渲染出两个 <img> 元素及说明文字。

测试 2 (新): 验证包含 DonationSection 的父组件（如 Footer 或 ResultPage 的模拟），在环境变量 NEXT_PUBLIC_ENABLE_DONATION 为 false 时，不渲染 DonationSection 组件。 

测试 3: 验证包含 DonationSection 的父组件，在环境变量 NEXT_PUBLIC_ENABLE_DONATION 为 true 时，渲染 DonationSection 组件。 

测试 4: （可选）模拟点击/悬停事件，验证预留的事件处理器被调用。
    * **运行测试**: 确认测试因组件尚未实现而失败。

### 🔄 实现步骤/要求 (Implementation Steps)
1. (需先完成) 获取二维码图片并放置到 public/images/ 目录下。

2. 添加环境变量: 在 .env.development (以及 .env.example 或类型定义) 中添加 NEXT_PUBLIC_ENABLE_DONATION=true (或其他默认值)。

3. 创建组件文件: 创建 DonationSection.tsx 和 DonationSection.test.tsx。

4. 编写测试: 按照“测试策略”编写失败的测试用例，包括环境变量控制渲染的测试。

5. 实现组件: 编写 DonationSection 组件的代码，使其通过渲染相关的测试。

6. 实现条件渲染: 在 Footer.tsx 和 result/page.tsx 中，读取 process.env.NEXT_PUBLIC_ENABLE_DONATION 的值，并根据其值条件渲染 DonationSection 组件。确保相应的测试通过。

7. 样式调整: 使用 Tailwind CSS 确保样式。

### ✅ 完成检查清单 (Completion Checklist)
[ ] .env 文件已添加 NEXT_PUBLIC_ENABLE_DONATION 变量。

[ ] DonationSection 组件已创建。

[ ] DonationSection.test.tsx 已创建并通过。

[ ] 包含条件渲染逻辑的父组件测试已创建并通过。

[ ] 组件能正确接收并显示二维码图片和说明文字。

[ ] 组件已在页脚和结果页根据环境变量成功集成并按预期显示/隐藏。 

[ ] UI 风格符合项目规范。

[ ] 已为追踪事件预留了明确的 DOM 属性和事件处理器。

[ ] Lint 和类型检查通过。

[ ] 代码已提交，Commit Message 符合规范 (e.g., feat(web): add donation QR code section with feature flag)。 

---