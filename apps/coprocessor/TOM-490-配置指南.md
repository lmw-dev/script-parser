# TOM-490: 阿里云热词配置指南

## 📋 配置进度

- [x] **.env 文件已添加配置项** ✅
- [x] **.env.example 已更新** ✅
- [ ] **阿里云控制台创建热词表** ⏳ (待完成)
- [ ] **获取并填写 vocabulary_id** ⏳ (待完成)

---

## 🚀 快速开始

### 当前状态

配置项已添加到 `.env` 文件，但仍为占位符值：

```bash
# V3.0 - TOM-490: 科技评测专用热词表ID
ALIYUN_TECH_HOTWORD_ID=your_vocabulary_id_here  # 需要替换为实际值
```

### 验证配置

运行验证脚本：

```bash
python verify_hotword_config.py
```

---

## 📝 完整配置步骤

### 步骤 1: 登录阿里云控制台

- **控制台地址**: https://nls-portal.console.aliyun.com/
- 使用你的阿里云账号登录
- 确保账号已开通「智能语音交互」服务

### 步骤 2: 创建业务专属热词表

1. **导航到热词管理**
   - 左侧菜单: `自学习平台` → `热词`
   - 点击 `创建热词表` 按钮

2. **填写热词表信息**
   - **名称**: `tech_vocab_v1_2025` (建议带版本号)
   - **类型**: 选择 **"业务专属热词表"** ⚠️ 重要
   - **描述**: "V3.0 科技产品评测专用热词库 (TOM-488)"

3. **导入热词**
   
   **方法 A - 批量导入** (推荐):
   - 打开 `app/assets/tech_vocab_v1.json`
   - 将 JSON 中的 `words` 数组内容转换为文本格式（每行一个词）
   - 使用控制台的「批量导入」功能上传
   
   **方法 B - 手动添加**:
   - 从 `tech_vocab_v1.json` 中复制词汇
   - 在控制台界面逐个添加（适合测试）

4. **保存并获取ID**
   - 点击 `保存` 或 `创建`
   - 在热词表列表中找到刚创建的热词表
   - **复制「热词表ID」(vocabulary_id)**
   - 格式: 类似 `abc123xyz456` 或 UUID 字符串

### 步骤 3: 更新环境变量

1. 打开 `.env` 文件：
   ```bash
   vim .env
   # 或使用其他编辑器: code .env
   ```

2. 找到以下行并替换值：
   ```bash
   # 修改前:
   ALIYUN_TECH_HOTWORD_ID=your_vocabulary_id_here
   
   # 修改后 (替换为实际的热词表ID):
   ALIYUN_TECH_HOTWORD_ID=abc123xyz456
   ```

3. 保存文件并验证：
   ```bash
   python verify_hotword_config.py
   ```
   
   如果看到 ✅ 配置成功，说明配置完成！

### 步骤 4: 重启服务 (如果服务正在运行)

如果 FastAPI 开发服务器正在运行，需要重启以加载新的环境变量：

```bash
# 停止现有服务 (Ctrl+C)
# 重新启动
uvicorn app.main:app --reload
```

---

## 🔍 验证方法

### 方法 1: 运行验证脚本 (推荐)

```bash
python verify_hotword_config.py
```

### 方法 2: Python 交互式验证

```python
import os
from dotenv import load_dotenv

load_dotenv(dotenv_path=".env")
hotword_id = os.getenv("ALIYUN_TECH_HOTWORD_ID")

if hotword_id and hotword_id != "your_vocabulary_id_here":
    print(f"✅ 配置成功: {hotword_id}")
else:
    print("⚠️ 仍为占位符，需要更新")
```

### 方法 3: 检查文件内容

```bash
grep ALIYUN_TECH_HOTWORD_ID .env
```

---

## 📚 参考资料

- **阿里云官方文档**: [使用SDK设置业务专属热词](https://help.aliyun.com/zh/isi/developer-reference/use-an-sdk-to-specify-the-id-of-a-business-specific-hotword-vocabulary)
- **控制台地址**: https://nls-portal.console.aliyun.com/
- **热词资产**: `app/assets/tech_vocab_v1.json` (TOM-488 交付物，248 个科技术语)
- **Prompt 文档**: `docs/prompts/TOM-490.prompt.aliyun-hotword-integration.md`

---

## ⚠️ 常见问题

### Q1: 找不到「自学习平台」菜单？

**A**: 确保你的账号已开通「智能语音交互」服务，并且有对应的权限。

### Q2: 创建热词表时选错了类型怎么办？

**A**: 必须选择 **"业务专属热词表"**。如果选错，建议删除重建，或在控制台查看是否可以修改类型。

### Q3: 热词表ID在哪里找？

**A**: 在控制台的热词表列表中，每个热词表都会显示一个唯一的 ID，通常在列表的右侧或详情页面中。

### Q4: 配置后还是提示占位符？

**A**: 
1. 检查 .env 文件是否保存
2. 确认没有多余的空格或引号
3. 重启服务以加载新配置
4. 重新运行验证脚本

### Q5: 可以使用项目级热词表吗？

**A**: 不可以。根据阿里云文档，项目级热词表会自动绑定到 AppKey，但 **业务专属热词表** 必须在代码中显式设置 ID 才能生效。

---

## 🎯 下一步

配置完成后，你可以：

1. **开始编码实现** (TOM-490)
   - 运行验证脚本确认配置成功
   - 开始 TDD 开发流程
   - 编写测试用例并实现功能

2. **查看实现计划**
   - 参考 `docs/prompts/TOM-490.prompt.aliyun-hotword-integration.md`
   - 按照 6 个步骤逐步实现

3. **联系开发者**
   - 如果遇到阻塞问题，及时沟通
   - 记录配置过程中的任何特殊情况

---

**最后更新**: 2025-11-11  
**任务**: TOM-490 - Coprocessor: 集成阿里云"自定义热词"API  
**状态**: ⏳ 配置中 (环境变量已添加，等待阿里云控制台操作)

