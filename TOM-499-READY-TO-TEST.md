# 🚀 TOM-499 端到端测试启动指南\n\n**日期**: 2025-11-12  \n**状态**: ✅ **准备就绪** - 所有代码已完成，环境已配置\n\n---\n\n## 📌 现状总结\n\n### ✅ 已完成项\n\n- [x] **6个核心开发任务** (TOM-489, TOM-490, TOM-491, TOM-492, TOM-494, TOM-499)\n- [x] **前端实现**: 分析模式选择器 + 动态渲染\n- [x] **后端实现**: 热词注入 + 赛道路由器\n- [x] **代码质量**: 单元测试 > 85%，无 TypeScript 错误\n- [x] **关键修复**: `result/page.tsx` 已使用 `resetPartial()`\n- [x] **环境配置**: 热词ID已配置，服务运行正常\n\n### 🔄 正在进行\n\n- 🧪 **E2E验收测试** (TOM-499) ← **你现在的任务**\n\n### 📊 当前环境\n\n| 项目 | 状态 | 详情 |\n|------|------|------|\n| **Web App** | ✅ 运行 | Next.js Turbopack, Port 3000 |\n| **API Service** | ✅ 运行 | FastAPI Uvicorn, Port 8000 |\n| **热词配置** | ✅ 就绪 | ID: `0fd60c73...`, 248个术语 |\n| **所有代码** | ✅ 完成 | 已通过 Lint, Type Check |\n\n---\n\n## 🎯 你的任务: E2E测试\n\n### 核心目标\n验证V3.0 MVP的5条完整业务流程是否按设计工作，确保：\n1. ✅ V2.0功能未被破坏（回归测试）\n2. ✅ V3.0新功能正常工作（核心价值验证）\n3. ✅ 系统可靠性保持（主备切换验证）\n4. ✅ 用户体验符合设计（UX验证）\n\n### 5条测试路径\n\n| # | 名称 | 目标 | 时间 | 难度 |\n|---|------|------|------|------|\n| **E2E 1** | V2.0回归 | 通用叙事模式不破坏 | 5-10m | ⭐ |\n| **E2E 2** | V3.0核心 | 科技模式99%+准确 | 10-15m | ⭐⭐ |\n| **E2E 3** | 智能重置 | 保留模式选择 | 2-3m | ⭐ |\n| **E2E 4** | 强制选择 | 防止误操作 | 3-5m | ⭐ |\n| **E2E 5** | 故障切换 | LLM备用可靠 | 15-20m | ⭐⭐⭐ |\n| **总计** | | | **45-60m** | |\n\n---\n\n## 📚 文档导航\n\n### 快速开始\n👉 **推荐先读**: `docs/testing/E2E-Quick-Reference.md`  \n   - 30秒快速开始\n   - 5条路径速查表\n   - 常见问题排查\n\n### 详细指南\n📖 **完整参考**: `docs/testing/TOM-499-E2E-Test-Execution-Report.md`\n   - 详细的步骤说明\n   - 验证点检查清单\n   - 日志过滤方法\n\n### 项目信息\n🏗️ **架构总结**: `docs/V3.0-MVP-Completion-Summary.md`\n   - 完整架构图\n   - 6个任务的成就\n   - 技术指标汇总\n\n---\n\n## 🚀 立即开始\n\n### 步骤 1: 前置检查 (1分钟)\n\n```bash\n# 在项目根目录运行\nscripts/e2e-quick-check.sh\n\n# 应该全部显示 ✅\n# ✅ Web App (Next.js) 运行中\n# ✅ AI Coprocessor (FastAPI) 运行中\n# ✅ 热词ID已配置\n# ✅ result/page.tsx 使用 resetPartial()\n# ✅ app-store.ts 包含 analysisMode 状态\n```\n\n### 步骤 2: 打开浏览器\n\n```\nhttp://localhost:3000\n```\n\n### 步骤 3: 执行5个测试路径\n\n参考 `E2E-Quick-Reference.md` 中的速查表，按顺序执行：\n\n1. **E2E 路径 1** - 选择\"通用叙事\" + 非科技视频\n2. **E2E 路径 2** - 选择\"科技产品评测\" + 科技视频\n3. **E2E 路径 3** - 验证\"智能重置\"\n4. **E2E 路径 4** - 验证\"强制选择\"\n5. **E2E 路径 5** - 模拟LLM故障转移\n\n### 步骤 4: 记录结果\n\n在 `docs/testing/TOM-499-E2E-Test-Execution-Report.md` 中填写：\n- 每条路径的测试URL\n- 关键验证点的通过/失败\n- 相关日志片段\n- 截图说明\n\n### 步骤 5: 完成报告\n\n```bash\n# 提交测试报告\ngit add docs/testing/TOM-499-E2E-Test-Execution-Report.md\ngit commit -m \"test(e2e): TOM-499 all 5 paths completed successfully\"\n\n# 更新Linear Issue\n# 1. 打开: https://linear.app/tomorrow-persistence/issue/TOM-499\n# 2. 设置状态: Done\n# 3. 添加评论: 附加测试报告和发现\n```\n\n---\n\n## 📊 预期结果\n\n### 成功标志 ✅\n\n- [ ] **E2E 1**: V2.0模式显示钩子/核心/CTA (无热词注入)\n- [ ] **E2E 2**: V3.0模式显示参数/卖点/价格/评价 (带热词注入) + 科技术语识别准确\n- [ ] **E2E 3**: \"再分析一个\"后模式保留为\"科技产品评测\"\n- [ ] **E2E 4**: URL有效+模式未选时按钮禁用; 模式选后按钮启用\n- [ ] **E2E 5**: DeepSeek失败时自动切换到Kimi, 结果仍正常显示\n\n### 如果遇到失败 ❌\n\n1. **查看问题排查指南**  \n   📄 `E2E-Quick-Reference.md` 中的\"常见问题排查\"\n\n2. **检查日志**  \n   - Web App: 搜索 \"analysisMode\", \"POST /api/parse\"\n   - API: 搜索 \"analysis_mode\", \"vocabulary_id\", \"Loading prompt\"\n\n3. **验证代码**  \n   - 确认 `result/page.tsx` 第27行是 `resetPartial()`\n   - 确认 `asr_service.py` 中有热词注入逻辑\n   - 确认 `llm_track_router.py` 存在\n\n4. **寻求帮助**  \n   - 查看完整测试报告中的详细步骤\n   - 参考技术方案文档中的架构设计\n\n---\n\n## 🎓 关键概念速览\n\n### V3.0核心创新\n\n```\nUI选择 (前端)           →  分析模式路由 (后端)      →  结果适配 (前端)\n┌─────────────────┐       ┌──────────────────┐       ┌─────────────────┐\n│ \"通用叙事分析\"  │       │ Prompt选择       │       │ 钩子/核心/CTA   │\n│      vs         │   →   │ ASR热词选择      │   →   │      vs         │\n│ \"科技产品评测\"  │       │ 结果Schema选择   │       │ 参数/卖点/价格  │\n└─────────────────┘       └──────────────────┘       └─────────────────┘\n     用户决策              智能路由 (V3.0新增)       动态渲染 (V3.0新增)\n```\n\n### 热词优化效果\n\n```\nV2.0: 科技术语 70% → 说 \"骁龙8 Gen 3\" 变成 \"消息8件3\"\n                                      ↓\nV3.0: 科技术语 99%+ → 使用热词库 (248个术语)\n                     → 准确识别 \"骁龙8 Gen 3\"\n```\n\n### 主备切换流程\n\n```\n用户请求\n    ↓\n尝试 DeepSeek\n    ├─ 成功 → 返回结果 ✓\n    └─ 失败 → 自动切换\n         ↓\n      尝试 Kimi\n         ├─ 成功 → 返回结果 ✓\n         └─ 失败 → 返回错误 ✗\n```\n\n---\n\n## 💡 测试技巧\n\n### 日志快速定位\n\n**在 Coprocessor 终端**:\n```bash\n# 搜索关键词 (Ctrl+F)\nanalysis_mode      # 找分析模式\nvocabulary_id      # 找热词注入\nLoading prompt     # 找Prompt选择\nPrimary service    # 找主服务调用\nFallback           # 找故障切换\n```\n\n### 浏览器DevTools检查\n\n**F12 → Network 标签**:\n1. 搜索 `/api/parse`\n2. 点击对应行\n3. 查看 Response 中的:\n   - `schema_type` (\"v2_narrative\" 或 \"v3_tech_spec\")\n   - `product_parameters` (V3.0才有)\n   - `analysis.hook` (V2.0才有)\n\n### 日志过滤命令\n\n```bash\n# Mac/Linux 终端中，在 Coprocessor 目录运行:\ngrep -i \"vocabulary_id\" <(tail -f *.log)  # 监控热词\ngrep -i \"analysis_mode\" <(tail -f *.log) # 监控模式\n```\n\n---\n\n## 📞 关键联系方式\n\n| 需求 | 资源 |\n|------|------|\n| **快速查阅** | `E2E-Quick-Reference.md` |\n| **详细步骤** | `TOM-499-E2E-Test-Execution-Report.md` |\n| **架构理解** | `V3.0-MVP-Completion-Summary.md` |\n| **Linear Issue** | https://linear.app/tomorrow-persistence/issue/TOM-499 |\n| **技术讨论** | Warp Notebooks / Cursor Rules |\n\n---\n\n## ⏰ 时间规划\n\n```\n现在: 2025-11-12 09:45 UTC+8\n\n09:45 → 10:00  准备工作 (15分钟)\n         ├─ 运行快速检查\n         └─ 打开文档\n\n10:00 → 10:50  执行测试 (50分钟)\n         ├─ E2E 1 (5-10m)\n         ├─ E2E 2 (10-15m)\n         ├─ E2E 3 (2-3m)\n         ├─ E2E 4 (3-5m)\n         └─ E2E 5 (15-20m)\n\n10:50 → 11:00  完成报告 (10分钟)\n         ├─ 填写结果\n         ├─ Git提交\n         └─ 更新Linear\n\n目标: 11:00 前完成 ✅\n```\n\n---\n\n## 🎯 成功标准\n\n### 最低要求 (MVP)\n- ✅ 5个E2E路径全部执行\n- ✅ 记录每个路径的结果\n- ✅ 提交测试报告\n\n### 优秀标准 (Excellent)\n- ✅ 所有路径全部通过\n- ✅ 截图记录关键验证点\n- ✅ 日志分析完整\n- ✅ 发现并记录任何潜在问题\n- ✅ 代码审查通过\n\n### 完美标准 (Perfect)\n- ✅ 以上全部完成\n- ✅ 生产环境也验证一遍\n- ✅ 编写优化建议\n- ✅ 更新项目文档\n\n---\n\n## 📝 任务检查清单\n\n- [ ] 阅读本文件\n- [ ] 运行 `scripts/e2e-quick-check.sh`\n- [ ] 打开浏览器访问 `http://localhost:3000`\n- [ ] 阅读 `E2E-Quick-Reference.md`\n- [ ] 执行 **E2E 路径 1** (V2.0回归)\n- [ ] 执行 **E2E 路径 2** (V3.0核心)\n- [ ] 执行 **E2E 路径 3** (智能重置)\n- [ ] 执行 **E2E 路径 4** (强制选择)\n- [ ] 执行 **E2E 路径 5** (故障切换)\n- [ ] 填写测试报告\n- [ ] Git提交\n- [ ] 更新Linear Issue为 \"Done\"\n- [ ] 发送完成通知\n\n---\n\n## 🎉 准备就绪!\n\n**所有系统已就位，代码已完成，环境已配置。**\n\n👉 **现在就打开浏览器开始测试吧!**\n\n```\nhttp://localhost:3000\n```\n\n**预计 60 分钟内完成所有测试。**\n\n---\n\n**开始时间**: 2025-11-12  \n**预计完成**: 2025-11-12 11:00 UTC+8  \n**状态**: ✅ **GO GO GO!**\n"}